<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>lumo vs planck vs clojure vs pixie.</title>
  <meta name="description" content="Between bits and bytes and all other pieces.<br/>A tech blog about Clojure, Software Architecture, and Distributed Systems">
  <meta name="author" content="Bruno Bonacci">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Bits and pieces">
  <meta name="twitter:description" content="Between bits and bytes and all other pieces.<br/>A tech blog about Clojure, Software Architecture, and Distributed Systems">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Bits and pieces">
  <meta property="og:description" content="Between bits and bytes and all other pieces.<br/>A tech blog about Clojure, Software Architecture, and Distributed Systems">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.brunobonacci.com//2017/08/10/lumo-vs-planck-vs-clojure-vs-pixie/">
  <link rel="alternate" type="application/rss+xml" title="Bits and pieces" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Bits and pieces">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Bits and pieces</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Between bits and bytes and all other pieces.<br/>A tech blog about Clojure, Software Architecture, and Distributed Systems</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/projects" title="link to Bits and pieces Projects" class="blog-button">Projects</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                  <li class="navigation__item"><a href="/#blog" title="link to Bits and pieces blog" class="blog-button">Blog</a></li>
              </ul>
          </nav>

          <!--
          <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                  <li class="navigation__item"><a href="/tags" title="link to Bits and pieces tags" class="blog-button">Tags</a></li>
              </ul>
          </nav>

          <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                  <li class="navigation__item"><a href="/categories" title="link to Bits and pieces categories" class="blog-button">Categories</a></li>
              </ul>
          </nav>
          -->

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/BrunoBonacci" title="@BrunoBonacci on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/brunobonacci" title="brunobonacci on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/BrunoBonacci" title="BrunoBonacci on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="10 Aug 2017" class="post-meta__date date">10 Aug 2017</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#Clojure">Clojure</a> </span>
    </div>
    <h1 class="post-title">lumo vs planck vs clojure vs pixie.</h1>
  </header>

  <section class="post">
    <p>I was looking to use Clojure for scripting. A few years ago there was
not much options. Recently the scenario changed rapidly. The options
currently available are:</p>

<ul>
  <li>Use Clojure in the JVM with <a href="https://github.com/BrunoBonacci/lein-binplus">lein-binplus</a></li>
  <li>Use ClojureScript with <a href="https://github.com/anmonteiro/lumo">lumo</a></li>
  <li>Use ClojureScript with <a href="https://github.com/mfikes/planck">planck</a></li>
  <li>Use <a href="https://github.com/pixie-lang/pixie">pixie-lang</a></li>
</ul>

<p>Each of the options have advantages and disadvantages. Clojure with
the JVM has brings the full power of the JVM, the portability to many
different target platforms, an endless ecosystem of libraries,
multi-threading, etc. However the JVM+Clojure has a startup cost
which is more accentuated on short execution scripts.</p>

<p>ClojureScript engines have emerged more recently thanks to the fact
that the ClojureScript compiler is now bootstrapped in JavaScript
(aka: you don’t need Java to compile ClojureScript).</p>

<p>Two tools, in this space, have become quite popular
recently: <a href="https://github.com/mfikes/planck">planck</a>
and <a href="https://github.com/anmonteiro/lumo">lumo</a>. The first one
uses
<a href="https://developer.apple.com/documentation/javascriptcore">JavaScriptCore</a> ported
to <code class="highlighter-rouge">C</code> for portability. The second one
uses <a href="https://github.com/v8/v8">V8 engine</a>.  Both offer ways to
connect to the host system and to leverage available libraries in the
ClojureScript ecosystem.</p>

<p>Finally <a href="https://github.com/pixie-lang/pixie">pixie-lang</a> is a
Clojure-like language which implements its own virtual machine on top
of the <a href="https://rpython.readthedocs.io/en/latest/">RPython</a> framework.
Isn’t fully compatible with Clojure, however is similar enough to feel
familiar. Additionally it offers a easy FFI access which allows
easy access to native C libraries. It implement its own tracing JIT
compiler.</p>

<p>I ran a few tests with all of them and one test in particular surprised me.
I ran the following script in all of them and capture the execution time:</p>

<div class="language-clojure highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="err">Σ</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">reduce</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">range</span><span class="w"> </span><span class="p">(</span><span class="nb">inc</span><span class="w"> </span><span class="n">n</span><span class="p">))))</span><span class="w">

</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="err">Σ</span><span class="w"> </span><span class="mi">1000000000</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Here are the results:</p>

<h3 id="lumo">Lumo</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>lumo --help
Lumo 1.6.0
<span class="o">(</span>...<span class="o">)</span>

<span class="gp">$ </span><span class="nb">time </span>lumo -e <span class="s2">"(defn Σ [n] (reduce + (range (inc n)))) (println (Σ 1000000000))"</span>
<span class="c">#'cljs.user/Σ</span>
500000000067109000

real     0m46.851s
user     0m46.750s
sys      0m0.123s
</code></pre>
</div>

<h3 id="planck">Planck</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>planck -V
2.6.0

<span class="gp">$ </span><span class="nb">time </span>planck -e <span class="s2">"(defn Σ [n] (reduce + (range (inc n)))) (println (Σ 1000000000))"</span>
500000000067109000

real    0m17.756s
user    0m17.972s
sys     0m1.504s
</code></pre>
</div>

<h3 id="jvm-clojure">JVM Clojure</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -version
java version <span class="s2">"1.8.0_45"</span>
Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.8.0_45-b14<span class="o">)</span>
Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 25.45-b02, mixed mode<span class="o">)</span>

<span class="gp">$ </span><span class="nb">time </span>java -jar clojure-1.8.0.jar -e <span class="s2">"(defn Σ [n] (reduce + (range (inc n)))) (println (Σ 1000000000))"</span>
<span class="c">#'user/Σ</span>
500000000500000000

real    0m7.554s
user    0m7.891s
sys     0m0.437s
</code></pre>
</div>

<h3 id="pixie-lang">Pixie-lang</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>./pixie-vm -v
Pixie 0.1 <span class="o">(</span>36ce07e<span class="o">)</span>

<span class="gp">$ </span><span class="nb">time</span> ./pixie-vm -e <span class="s2">"(defn Σ [n] (reduce + (range (inc n)))) (println (Σ 1000000000))"</span>
500000000500000000

real    0m0.672s
user    0m0.659s
sys     0m0.008s
</code></pre>
</div>

<h2 id="results">Results</h2>

<p>Summary table:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>| Tool           | Elapsed time |
|----------------|-------------:|
| lumo           |      46.851s |
| planck         |      17.756s |
| JVM            |       7.554s |
| JVM (pre-warm) |       6.320s |
| pixie          |       0.672s |
</code></pre>
</div>

<p>Now leaving aside the fact that for some reason both <code class="highlighter-rouge">planck</code> and
<code class="highlighter-rouge">lumo</code> got the wrong result [<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>], the difference in timing
is impressive.  The most impressive result is the <code class="highlighter-rouge">pixie-vm</code> JIT
performance which in this special case of tight loop it goes even
faster than the JVM.  Even removing the JVM cold start and Clojure
compilation JVM still performs around <code class="highlighter-rouge">6.3s</code>.</p>

<p>I don’t know whether the work on <code class="highlighter-rouge">pixie</code> it is going to proceed,
however the benchmark result is the testament of the great work
that <em>Timothy Baldridge et al.</em> have put into this project.</p>

<hr />

<h5 id="footnotes">Footnotes:</h5>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><code class="highlighter-rouge">planck</code> and <code class="highlighter-rouge">lumo</code> and ClojureScript in general are hosted
on top of JavaScript. <a href="https://www.ecma-international.org/ecma-262/6.0/#sec-terms-and-definitions-number-value">JavaScript
specifications</a>
defines only one type of primitive numeric value which is a
double-precision 64-bit <strong>floating point</strong> binary <strong>format IEEE
754-2008</strong> value. This floating point format defines 53-bits for
the mantissa which stores the actual number, some of which could
be decimal part. If you are representing a integer value then you
can use all 53-bits for the integer part. Therefore the largest
integer you can represent in this case is <code class="highlighter-rouge">2^53 -1</code> which is
<strong>9007199254740991</strong>. The reason why <code class="highlighter-rouge">planck</code> and <code class="highlighter-rouge">lumo</code> show a
different result is that the result of the operation is way larger
than the max integer in JavaScript so the sum operator computes
the result and it rounds it up to the nearest representable value
in <em>IEEE 754-2008 format</em> (see: <a href="https://www.ecma-international.org/ecma-262/6.0/#sec-applying-the-additive-operators-to-numbers">Applying the Additive Operators
to
Numbers</a>). Clojure
over Java or .Net and <code class="highlighter-rouge">pixie</code> use a 64-bit integer format which it
can fully represent the result of the operation.&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'bitsandpieces2'; // required: replace example with your forum shortname
        var disqus_config = function () {
          this.page.url = 'https://blog.brunobonacci.com/2017/08/10/lumo-vs-planck-vs-clojure-vs-pixie/';
          this.page.identifier = '/2017/08/10/lumo-vs-planck-vs-clojure-vs-pixie';
          this.page.title = 'lumo vs planck vs clojure vs pixie.';
        };
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2013-2023 Bruno Bonacci. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51571233-1', 'auto');
  ga('send', 'pageview');
</script>


    </div>
  </body>
</html>